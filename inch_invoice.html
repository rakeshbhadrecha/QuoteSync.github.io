<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Sections with Custom Section Name</title>
     <!-- Bootstrap 5 CSS -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
     <!-- Font Awesome for icons -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <style>
        /* navbar style start */
        :root {
            --primary-color: #000000;
            --secondary-color: #ffffff;
            --accent-color: #555555;
            --light-gray: #f8f9fa;
            --dark-gray: #212529;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--primary-color);
            background-color: var(--secondary-color);
            line-height: 1.6;
        }
        
        .navbar {
            background-color: var(--secondary-color);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary-color) !important;
        }
        
        .nav-link {
            color: var(--primary-color) !important;
            font-weight: 500;
            margin: 0 10px;
        }
        
        .nav-link:hover {
            color: var(--accent-color) !important;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .btn-outline:hover {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }
        
        
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
        }
                /* Custom styling for perfect alignment */
        .logo-placeholder {
            transition: transform 0.3s ease;
        }

        .navbar-brand:hover .logo-placeholder {
            transform: rotate(15deg);
        }

        .brand-text {
            letter-spacing: -0.5px;
            position: relative;
            top: 1px; /* Fine-tune text alignment */
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 15px;
            position: relative;
        }

        .navbar-nav .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #000;
            transition: width 0.3s ease;
        }

        .navbar-nav .nav-link:hover::after {
            width: 100%;
        }

        @media (max-width: 991.98px) {
            .navbar-collapse {
                margin-top: 15px;
            }
            .nav-link {
                margin: 8px 0 !important;
            }
        }
        /* navbar style end */
        .section {
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
            border-radius: 8px;
            width: 100%;
        }
        
        .remove-row {
            cursor: pointer;
            color: red;
        }

        .remove-section {
            margin-top: 10px;
        }

        .first-section {
            height: 500px;
        }

        body {
            background-color: #eeeeee;
        }

        .container {
            background-color: #fff;
        }

          /* For Chrome, Safari, Edge, and Opera */
  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* For Firefox */
  input[type="number"] {
    -moz-appearance: textfield;
    font-size: 14px;
  }
  .form-control:focus {
      box-shadow: 0 0 0 0.2rem rgba(72, 72, 72, 0.25); /* Grey shadow */
      border-color: #ced4da; /* Optional: You can also change the border color */
    }
    .form-control{
        font-size: 14px;

    }

.form-select:focus {
      box-shadow: 0 0 0 0.2rem rgba(72, 72, 72, 0.25); /* Grey shadow */
      border-color: #ced4da; /* Optional: You can also change the border color */
    }
    .remove-row:hover {
    background-color: red; /* Button background */
    /* border: none; */
}
    </style>
     <script>
    // Set current date as default value
    const dateInput = document.getElementById('date');
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const dd = String(today.getDate()).padStart(2, '0');
    dateInput.value = `${yyyy}-${mm}-${dd}`;
  </script>
</head>
<body>
<!-- nav bar start -->
<nav class="navbar navbar-expand-lg navbar-light sticky-top">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#" style="gap: 0.75rem;">
            <!-- Temporary logo (replace with your image) -->
            <div class="logo-placeholder bg-dark text-white d-flex align-items-center justify-content-center rounded" 
                 style="width: 40px; height: 40px; font-size: 1.1rem;">
                <img src="assets/Untitled design (1).png" style="width: 40px; height: 40px;"alt="">
            </div>
            <span class="brand-text fw-bold fs-4">QuoteSync</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="postlogin.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#screenshots">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#pricing">Account</a>
                </li>
               
            </ul>
            
        </div>
    </div>
</nav>
 <!-- nav bar end -->
<div class="container" style="margin-top: 160px; max-width: 1200px;">
    <form  id="invoiceForm" action="invoiceformat1.php" method="POST" target="_blank">
        <!-- From and To Information -->
        <div class="row mb-4" style="padding: 20px;">
            <div class="col-md-6">
                <img src="assets/Untitled design (1).png" style="width: 140px; height: 140px; margin-top: 15px;" alt="">
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-8 mb-1">
                        <label for="ship_to" class="form-label"><b>FROM</b></label>
                        <input type="text" id="to" name="companyname" class="form-control" placeholder="Company Name" required>
                    </div>
                    <div class="col-md-8 mb-1">
                        <input type="text" id="to" name="companynumber" class="form-control" placeholder="Number" required>
                    </div>
                    <div class="col-md-8 mb-1">
                        <textarea class="form-control" name="companyaddress" rows="2" required>Address</textarea>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <br>
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-8 mb-1">
                        <label for="ship_to" class="form-label"><b>TO</b></label>
                        <input type="text" id="to" name="cname" class="form-control" placeholder="Customer Name" required>
                    </div>
                    <div class="col-md-8 mb-1">
                        <input type="text" id="to" name="cnumber" class="form-control" placeholder="Number" required>
                    </div>
                    <div class="col-md-8 mb-1">
                        <textarea class="form-control" name="caddress" rows="2" required>Address</textarea >
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label for="date" class="form-label" required><b>DATE</b></label>
                        <input type="date" id="date" name="date" class="form-control">
                        <label for="date" class="form-label" required><b>INVOICE NO:</b></label>
                        <input type="disabled" id="date" name="date" class="form-control" readonly>
                    </div>
                </div>
            </div>
        </div>

        <table class="table text-center">
            <thead class="table-dark">
                <tr>
                    <th scope="col" style="width: 28%;">Description</th>
                    <th scope="col" style="width: 15%;">Lenght (Feet/Inch)</th>
                    <th scope="col" style="width: 15%;">Width (Feet/Inch)</th>
                    <th scope="col" style="width: 5%;">Qty</th>
                    <th scope="col" style="width: 11%;">Sq.Ft</th>
                    <th scope="col" style="width: 10%;">Rate</th>
                    <th scope="col" style="width: 15%;">Amount</th>
                    <th scope="col" style="width: 2%;"></th>
                </tr>
            </thead>
        </table>

        <!-- Section Wrapper -->
<div id="sections">
    <!-- Sample Section (Template for Dynamic Sections) -->
    <div class="section" id="section1">
    <h5 style="background-color: #00000097; padding: 5px; margin-top: -10px;">
        <input type="text" class="form-control"  name="sectionname[1]" style="text-align: center; text-transform: uppercase;  width: 30%; margin-left: 35%;" placeholder="Enter custom section name" id="custom-section-name-1" required>
    </h5>
    <div class="rows" style="margin-top: -8px;">
        <table class="table text-center">
            <tbody id="item-fields-1">
                <tr>
                <th scope="col" style="width: 28%;" ><textarea name="descriptions[1][]" style="text-transform: uppercase;" class="form-control" placeholder="Description of item/service..." required></textarea>
                </td>
                <th scope="col" style="width: 15.5%;">
                        <input type="number" name="height_feet[1][]" class="form-control" placeholder="Feet" min="1" >
                        <input type="number" class="form-control" name="height_inches[1][]" placeholder="Inch" style="margin-top: 4px;" min="0" max="12" >
                    </td>
                    <th scope="col" style="width: 15.5%;">
                        <input type="number" name="width_feet[1][]" class="form-control" placeholder="Feet" min="1" >
                        <input type="number" class="form-control" name="width_inches[1][]" placeholder="Inch" style="margin-top: 4px;" min="0" max="12" >
                    </td>
                    <th scope="col" style="width: 8%;"><input type="number" name="quantities[1][]" class="form-control" value="1" min="1" required></td>
                    <th scope="col" style="width: 11%;"><input type="text" name="sqft[1][]"  style="color: rgb(90, 87, 87); text-align: center; border: none; outline: none; box-shadow: none;" class="form-control" value="0" ></td>
                    <th scope="col" style="width: 10%;"><input type="number" name="rates[1][]" class="form-control"  step="0.01" required></td>
                    <th scope="col" style="width: 15%;"><input type="text" name="amounts[1][]" style="color: rgb(90, 87, 87); text-align: center; border: none; outline: none; box-shadow: none;" class="form-control" value="0.00" readonly></td>
                    <th scope="col" style="width: 1%;"><button type="button" class="btn btn-outline-danger btn-sm remove-row">X</button></td>
                </tr>
            </tbody>
        </table>
        <button type="button" class="btn btn-outline-success add-row" data-section="1">+ New Line Item</button>
    </div>
    <button type="button" class="btn btn-outline-danger remove-section">Remove Section</button>
</div>

</div>


        <button type="button" class="btn btn-success" id="add-section">Add Section</button>

        <div class="row mb-4" style="margin-top: 100px;">
            <hr>
            <div class="col-md-6 offset-md-6">
                <table class="table">
                    <tbody>
                        <tr>
                            <td class="text-end fw-bold">Total</td>
                            <td class="text-end fw-bold">
    <input type="text" name="grand-total" id="grand-total" class="form-control" style="color: rgb(90, 87, 87); text-align: center; border: none; outline: none; box-shadow: none;" value="0.00" readonly>
</td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-center">
        <button type="button" class="btn btn-primary" id="generateInvoice">Generate Invoice</button>
    </div><br><br>
    </form>
</div>
<script>
$(document).ready(function() {
    let sectionCount = 1;

    // Add a new section
    $('#add-section').click(function() {
        sectionCount++;
        let sectionHtml = `
        <div class="section" id="section${sectionCount}">
           <h5 style="background-color: #00000097; padding: 5px; margin-top: -10px;">
                <input type="text" class="form-control" name="sectionname[${sectionCount}]" 
                       placeholder="Enter custom section name" style="text-align: center; text-transform: uppercase; width: 30%; margin-left: 35%;">
            </h5>
            <div class="rows">
                <table class="table text-center">
                    <tbody id="item-fields-${sectionCount}">
                        <tr>
                            <th scope="col" style="width: 28%;"><textarea style="text-transform: uppercase;" name="descriptions[${sectionCount}][]" class="form-control" placeholder="Description of item/service..." required></textarea>
                            </td>
                            <th scope="col" style="width: 15.5%;">
                                <input type="number" name="height_feet[${sectionCount}][]" class="form-control" placeholder="Feet" >
                               <input type="number" class="form-control" name="height_inches[${sectionCount}][]" placeholder="Inch" min="0" max="12"style="margin-top: 4px;" >
                                     
                            </td>
                            <th scope="col" style="width: 15.5%;">
                                <input type="number" name="width_feet[${sectionCount}][]" class="form-control" placeholder="Feet" >
                               <input type="number" class="form-control" name="width_inches[${sectionCount}][]" placeholder="Inch" min="0" max="12"  style="margin-top: 4px;" >
                                     
                            </td>
                            <th scope="col" style="width: 8%;"><input type="number" name="quantities[${sectionCount}][]" class="form-control" value="1" required></td>
                            <th scope="col" style="width: 11%;"><input type="text" name="sqft[${sectionCount}][]" style="color: rgb(90, 87, 87); text-align: center; border: none; outline: none; box-shadow: none;" class="form-control" readonly ></td>
                            <th scope="col" style="width: 10%;"><input type="number" name="rates[${sectionCount}][]" class="form-control" step="0.01" required></td>
                            <th scope="col" style="width: 15%;"><input type="text" name="amounts[${sectionCount}][]" style="color: rgb(90, 87, 87); text-align: center; border: none; outline: none; box-shadow: none;" class="form-control" readonly></td>
                            <th scope="col" style="width: 1%;"><button type="button" class="btn btn-outline-danger btn-sm remove-row">X</button></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn btn-outline-success add-row" data-section="${sectionCount}">+ New Line Item</button>
            </div>
            <button type="button" class="btn btn-outline-danger remove-section">Remove Section</button>
        </div>`;
        $('#sections').append(sectionHtml);
    });

    // Add a new row to a section
    $(document).on('click', '.add-row', function() {
        const sectionId = $(this).data('section');
        const rowHtml = `
        <tr>
            <th scope="col" style="width: 28%;"><textarea style="text-transform: uppercase;" name="descriptions[${sectionCount}][]" class="form-control" placeholder="Description of item/service..." required></textarea>
            </td>
            <th scope="col" style="width: 15.5%;">
                <input type="number" name="height_feet[${sectionId}][]" class="form-control" placeholder="Feet" >
                <input type="number" class="form-control" name="height_inches[${sectionId}][]" placeholder="Inch" min="0" max="12" style="margin-top: 4px;" >
                    
            </td>
            <th scope="col" style="width: 15.5%;">
                <input type="number" name="width_feet[${sectionId}][]" class="form-control" placeholder="Feet" style="margin-top: 4px;" >
                <input type="number" class="form-control" name="width_inches[${sectionId}][]" placeholder="Inch" min="0" max="12" >
                    
            </td>
            <th scope="col" style="width: 8%;"><input type="number" name="quantities[${sectionId}][]" class="form-control" value="1" ></td>
            <th scope="col" style="width: 11%;"><input type="text" name="sqft[${sectionId}][]" class="form-control" readonly></td>
            <th scope="col" style="width: 10%;"><input type="number" name="rates[${sectionId}][]" class="form-control" step="0.01" ></td>
            <th scope="col" style="width: 15%;"><input type="text" name="amounts[${sectionId}][]" class="form-control" readonly></td>
            <th scope="col" style="width: 1%;"><button type="button" class="btn btn-outline-danger btn-sm remove-row">X</button></td>
        </tr>`;
        $(`#item-fields-${sectionId}`).append(rowHtml);
    });

    // Remove row
    $(document).on('click', '.remove-row', function() {
        $(this).closest('tr').remove();
    });

    // Remove section
    $(document).on('click', '.remove-section', function() {
        $(this).closest('.section').remove();
    });

    // Calculate Sq.Ft and Amount for each row
    $(document).on('input', 'input[name^="height_feet"], input[name^="height_inches"], input[name^="width_feet"], input[name^="width_inches"], input[name^="quantities"], input[name^="rates"]', function() {
        calculateSqFtAndAmount(this);
    });
   // Custom rounding function to 2 decimal places
   function roundToTwoDecimals(num) {
        return Math.round(num * 100) / 100;
    }

    // Function to calculate Sq.Ft and Amount for each row
function calculateSqFtAndAmount(input) {
    var row = $(input).closest('tr');

    // Get height (feet and inches), width (feet and inches), quantity, and rate
    var heightFeet = parseFloat(row.find('input[name^="height_feet"]').val()) || 0;
    var heightInches = parseFloat(row.find('input[name^="height_inches"]').val()) || 0;
    var widthFeet = parseFloat(row.find('input[name^="width_feet"]').val()) || 0;
    var widthInches = parseFloat(row.find('input[name^="width_inches"]').val()) || 0;
    var quantity = parseFloat(row.find('input[name^="quantities"]').val()) || 1;
    var rate = parseFloat(row.find('input[name^="rates"]').val()) || 0;

    // Convert inches to feet
    var heightinchescal = heightInches / 12; // Converts height inches to feet
    var widthinchescal = widthInches / 12;  // Converts width inches to feet

    // Convert height and width to feet (height in feet + inches in feet)
    var totalHeightInFeet = heightFeet + heightinchescal; // Total height in feet
    var totalWidthInFeet = widthFeet + widthinchescal;    // Total width in feet


    
    // Calculate Sq.Ft
    var sqft = 0;
    if (totalHeightInFeet > 0 && totalWidthInFeet > 0) {
        sqft = totalHeightInFeet * totalWidthInFeet * quantity; // If size is provided
        // Round the result to 2 decimal places
        sqft = roundToTwoDecimals(sqft);
    }

    // Update the Sq.Ft field with exactly 2 decimal places
    row.find('input[name^="sqft"]').val(sqft.toFixed(2));  // Ensure 2 decimal places

    // Calculate Amount
    var amount = 0;
    if (sqft > 0) {
        amount = sqft * rate; // If size is provided, calculate based on Sq.Ft
    } else {
        amount = quantity * rate; // If no size, calculate based on quantity only
    }

    row.find('input[name^="amounts"]').val(amount.toFixed(2)); // Update Amount field

    // Recalculate grand total
    calculateGrandTotal();
}

// Function to calculate the grand total for Sq.Ft and Amount
function calculateGrandTotal() {
    var totalSqFt = 0;
    var totalAmount = 0;

    // Loop through each section and row to sum up the square footage and amounts
    $('.section').each(function () {
        $(this).find('tbody tr').each(function () {
            var sqft = parseFloat($(this).find('input[name^="sqft"]').val()) || 0;
            var amount = parseFloat($(this).find('input[name^="amounts"]').val()) || 0;
            totalSqFt += sqft;
            totalAmount += amount;
        });
    });

    // Update the grand total fields
    $('#totalSqFt').text(totalSqFt.toFixed(2));
    $('#totalAmount').text(totalAmount.toFixed(2));

    // Update the grand total input field
    $('#grand-total').val(totalAmount.toFixed(2));  // Update grand total
}

    // Submit form data (use Ajax to submit form data to your server)
    $(document).ready(function () {
    $('#generateInvoice').click(function (event) {
        event.preventDefault(); // Prevent default form submission

        // Check if height and width are empty, and set default values if needed
        $('#invoiceForm input[name^="height_feet"], #invoiceForm input[name^="height_inches"], #invoiceForm input[name^="width_feet"], #invoiceForm input[name^="width_inches"]').each(function () {
            // If a field is empty, set it to 0
            if ($(this).val() === '') {
                $(this).val(0);
            }
        });

        // Serialize the form data
        const formData = $('#invoiceForm').serialize();

        // Send the form data using AJAX
        $.ajax({
            type: 'POST',
            url: 'invoiceformat1.php', // Backend script to handle the data
            data: formData,
            dataType: 'json',
            success: function (response) {
                if (response.status === 'success') {
                    // Log the data to the console for debugging
                    console.log('Server Response:', response.data);

                    // Redirect to another page or display success message
                    if (response.url) {
                        window.location.href = response.url; // Redirect to preview page
                    } else {
                        alert(response.message); // Show success message
                    }
                } else {
                    alert(response.message || 'An error occurred.');
                }
            },
            error: function (xhr, status, error) {
                console.error('AJAX Error:', status, error);
                alert('An unexpected error occurred while generating the invoice.');
            },
        });
    });
});



});
</script>
<!-- navbar script start -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
    
    // Login modal trigger
    document.addEventListener('DOMContentLoaded', function() {
        if(window.location.hash === '#login') {
            var loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        }
    });
</script>
 <!-- navbar script end -->
</body>
</html>
